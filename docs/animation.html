<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html><head><title>Fluxus manual v0.8</title><link rel="stylesheet" href="fluxusdoc.css"></head><body>
<hdr><a href="index.html">Fluxus manual</a> v0.8 : (C) 2005 Dave Griffiths : dave at pawfal dot org : <a href="http://www.pawfal.org">www.pawfal.org</a></hdr>

<h1>12.0 Animation sources</h1>
Animation sources are taps into the outside world. 

<big>12.1 Time</big>

The simplest source of information to use for animation is <c>(time)</c>, which 
returns the time in seconds since fluxus was started. This is good to use for 
animation, as it means your scripts will be frame rate independant - in other 
words the animation will look the same regardless of the machine it's running 
on, or the resolution etc.

Another time related call is <c>(delta)</c> which returns the change in time since 
the last frame. Technically, all your incremental animation data, regardless 
of source, should be scaled by this factor, to maintain frame rate 
independance.

<big>12.2 Audio</big>

Part of fluxus is responsible for capturing the incoming sound, and processing 
it into harmonic data, using fft (Fast Fourier Transform). The harmonics are 
bands of frequency which the sound is split into, giving some indication of 
the quality of the sound. It's the same as you see on a graphic equaliser - in 
fact, one of the example scripts (bars.scm) acts as a graphic equaliser 
display, and should be used to test the audio is working.

<c>(start-audio jack-port-name buffersize samplerate)</c>
starts up the audio with the specified settings, you'll need to call this 
first, or put it into .fluxus.scm in your home directory to call it 
automatically at startup. make the jack port name an empty string and it
won't try to connect to anything for you

<c>(gain value)</c>
sets the gain level for the fft sound, it's 1 by default.
	
<c>(gh band)
(get-harmonic band)</c>
returns the contribution of the harmonic specified. the harmonic band value 
wraps, so you can use without worrying about out of range errors.

<c>(process wavfilename)</c>
this command temporarally disables the realtime reading of the input audio 
stream and reads a wav file instead. for use with the framedump to process 
audio offline to make music videos.

<c>(smoothing-bias b)</c>
a kind of weighted average for the harmonic bands which smooth them out over 
time. this setting was hardcoded before (to 1.5) but the best setting really 
depends on the quality of the music, and the buffer sizes, and ranges from 
0 -> 2. it's obvious if you give it a try with the bars.scm script

<big>11.3  OSC</big> 

OSC stands for Open Sound Control, and is a widely used protocol for passing 
data between multimedia applications. Fluxus can send or receive messages.

<c>(osc-source port)</c>
starts up the osc server, listening to the given port

<c>(osc-msg name)</c>
returns true if the message has been received since last frame, and sets the 
current source to this message if it has been received. 

calling it repeatedly returns every message recieved in the last frame. you need to 
call it in a loop until it returns false, and all messages have been read - or your 
script will lag behind the data source.

<c>(osc index)</c>
returns either a number or string value from the current osc message source - 
ie, a message "/myvalue 0.4 hello" is sent to fluxus:

<c>(osc-msg "/myvalue")
(osc 0)</c>

will evaluate to 0.4. 

<c>(osc 1) </c>

will then evaluate to "hello". 

if a message has never been sent, the value defaults to zero, or a empty string.

<c>(osc-peek)</c>
this handy function returns the name, and format string and number/string 
arguments of the last sent message as a string. you can then write something 
like:

<c>(display (osc-peek)) (newline)</c>

and fluxus will dump a list of all the messages being recieved to the 
commandline, use this to figure out what messages to use, and the types you 
can use on the message.

An example of using osc to communicate between pd and fluxus:

 -- osc.scm

<c>(define (test)
    (push)
	(osc-msg "/zzz")
    (translate (vector 1 0 (osc 0)))
    (draw-cube)
    (pop))

(osc-source "6543")
(every-frame "(test)")</c>

--- EOF

--- zzz.pd
<c>#N canvas 618 417 286 266 10;
#X obj 58 161 sendOSC;
#X msg 73 135 connect localhost 6543;
#X msg 58 82 send /zzz \$1;
#X floatatom 58 29 5 0 0 0 - - -;
#X obj 58 54 / 100;
#X obj 73 110 loadbang;
#X connect 1 0 0 0;
#X connect 2 0 0 0;
#X connect 3 0 4 0;
#X connect 4 0 2 0;
#X connect 5 0 1 0;</c>

OSC messages can also be sent with fluxus.

<c>(osc-destination port)</c>
starts up the osc client, which will send messages to the given port. 
NOTE: due to the current implementation of the osc library fluxus uses, there 
will be a crash if the port is not fully specified, use strings like 
"osc.udp://localhost:4444" and it all seems to work fine

<c>(osc-send name argslist)</c>
sends a message with the argument list as the osc data. only supports numbers 
(which are converted to floats) and strings as data, ie:

<c>(osc-send "/hello" "fis" '(1 2 "three"))</c>

will send the message out to the current osc destination, the type string 
allows fluxus to convert the numbers correctly using "f" for float, or "i" for
int.
